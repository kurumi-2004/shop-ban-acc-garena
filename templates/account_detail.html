{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card" data-aos="fade-right">
            <div class="card-body">
                <h2 class="card-title">{{ account.title }}</h2>
                <div class="account-tags mb-3">
                    <span class="tag">{{ account.category }}</span>
                    {% if account.rank %}
                    <span class="tag rank">{{ account.rank }}</span>
                    {% endif %}
                    {% if account.is_sold %}
                    <span class="tag sold">Đã bán</span>
                    {% else %}
                    <span class="tag available">Còn hàng</span>
                    {% endif %}
                </div>
                
                <div class="account-price mb-4">{{ "{:,.0f}".format(account.price) }} ₫</div>
                
                {% if account.get_images() %}
                <div class="mb-4">
                    <h5>Hình ảnh:</h5>
                    <div id="accountImagesCarousel" class="carousel slide" data-bs-ride="carousel">
                        <div class="carousel-inner">
                            {% for image in account.get_images() %}
                            <div class="carousel-item {% if loop.first %}active{% endif %}">
                                <img src="{{ url_for('static', filename=image) }}" class="d-block w-100" style="border-radius: 10px; max-height: 400px; object-fit: contain;" alt="Account image {{ loop.index }}">
                            </div>
                            {% endfor %}
                        </div>
                        {% if account.get_images()|length > 1 %}
                        <button class="carousel-control-prev" type="button" data-bs-target="#accountImagesCarousel" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#accountImagesCarousel" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
                <h5>Mô tả:</h5>
                <p class="text-muted">{{ account.description or 'Không có mô tả' }}</p>
                
                {% if account.order and account.order.user_id == current_user.id and account.order.status == 'completed' %}
                <div class="alert alert-success mt-4">
                    <h5><i class="fas fa-check-circle"></i> Bạn đã mua tài khoản này</h5>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card" data-aos="fade-left">
            <div class="card-body">
                <h5>Thông tin tài khoản</h5>
                
                {% if account.order and account.order.user_id == current_user.id and account.order.status == 'completed' %}
                <div class="credentials-box">
                    <p><strong>Tài khoản:</strong> {{ account.get_decrypted_username() }}</p>
                    <p><strong>Mật khẩu:</strong> {{ account.get_decrypted_password() }}</p>
                </div>
                <div class="alert alert-warning">
                    <small><i class="fas fa-exclamation-triangle"></i> Vui lòng đổi mật khẩu sau khi nhận tài khoản</small>
                </div>
                {% else %}
                <div class="credentials-hidden">
                    <i class="fas fa-lock fa-3x mb-3"></i>
                    <p>Đã ẩn - hiển thị sau khi mua</p>
                </div>
                {% endif %}
                
                {% if current_user.is_authenticated and not account.is_sold %}
                <button onclick="addToCart({{ account.id }})" class="btn btn-primary w-100 mt-3">
                    <i class="fas fa-cart-plus"></i> Thêm vào giỏ hàng
                </button>
                {% elif not current_user.is_authenticated %}
                <a href="{{ url_for('login') }}" class="btn btn-primary w-100 mt-3">
                    <i class="fas fa-sign-in-alt"></i> Đăng nhập để mua
                </a>
                {% elif account.is_sold %}
                <button class="btn btn-secondary w-100 mt-3" disabled>
                    <i class="fas fa-times"></i> Đã bán
                </button>
                {% endif %}
                
                <a href="{{ url_for('index') }}" class="btn btn-outline-secondary w-100 mt-2">
                    <i class="fas fa-arrow-left"></i> Quay lại
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
